<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
  <title>PythonBlocks Demo</title>
  <script src="/storage.js"></script>
  <link rel="stylesheet" type="text/css" href="style.css">

  <script src="../../blockly_uncompressed.js"></script>
  <script src="../../python_compressed.js"></script>
  <script src="../../blocks_compressed.js"></script>
  <script src="../../core/python.js"></script>
  <script src="pycode.js" type="text/javascript"></script>
  <script src="../../msg/js/en.js"></script>
  <script src="../../blocks/pynumeric.js"></script>
  <script src="../../blocks/pystrings.js"></script>
  <script src="../../blocks/pyconversions.js"></script>
  <script src="../../blocks/pycomparisons.js"></script>
  <script src="../../blocks/pybooleans.js"></script>
  <script src="../../blocks/pylists.js"></script>
  <script src="../../blocks/pyio.js"></script>
  <script src="../../blocks/pycontrol.js"></script>
  <script src="../../blocks/pyvars.js"></script>
  <script src="../../generators/python/pybooleans.js"></script>
  <script src="../../generators/python/pycomparisons.js"></script>
  <script src="../../generators/python/pycontrol.js"></script>
  <script src="../../generators/python/pyconversions.js"></script>
  <script src="../../generators/python/pyio.js"></script>
  <script src="../../generators/python/pylists.js"></script>
  <script src="../../generators/python/pynumeric.js"></script>
  <script src="../../generators/python/pystrings.js"></script>
  <script src="../../generators/python/pyvars.js"></script>
  <script src="jquery.min.js" type="text/javascript"></script>
  <script src="skulpt.min.js" type="text/javascript"></script>
  <script src="skulpt-stdlib.js" type="text/javascript"></script>
  <script src="skulpt.js" type="text/javascript"></script>


  <script type="text/javascript">

   // The Browser API key obtained from the Google Developers Console.
   // Replace with your own Browser API key, or your own key.
   var developerKey = 'AIzaSyBIJVAC6TKBZmMwIFeOUjWPyIC_YfUWk-I';

   // The Client ID obtained from the Google Developers Console. Replace with your own Client ID.
   var clientId = "600830548447-tjkqh0qmskmjc8v1l3mrknn2k14ok2r4.apps.googleusercontent.com"

   // Replace with your own App ID. (Its the first number in your Client ID)
   var appId = "600830548447";

   // Hack - unify these
   var scope = ['https://www.googleapis.com/auth/drive'];
   var scopes = 'https://www.googleapis.com/auth/drive';

   var pickerApiLoaded = false;
   var oauthToken;
   var useProxy = false;
   var metaData = false;
   // Use the Google API Loader script to load the google.picker script.
   function loadPicker() {
     gapi.load('auth', {'callback': onAuthApiLoad});
     gapi.load('picker', {'callback': onPickerApiLoad});
   }

   function onAuthApiLoad() {
     window.gapi.auth.authorize(
         {
           'client_id': clientId,
           'scope': scope,
           'immediate': false
         },
         handleAuthResult);
   }

   function onPickerApiLoad() {
     pickerApiLoaded = true;
   }

   function handleAuthResult(authResult) {
     if (authResult && !authResult.error) {
       oauthToken = authResult.access_token;
     }
   }

   // Create and render a Picker object for searching images.
   function createPicker() {
     if (pickerApiLoaded && oauthToken) {
       var view = new google.picker.View(google.picker.ViewId.DOCS);
       view.setMimeTypes("text/plain,text/html");
       var picker = new google.picker.PickerBuilder()
           .enableFeature(google.picker.Feature.NAV_HIDDEN)
           .setAppId(appId)
           .setOAuthToken(oauthToken)
           .addView(view)
           .addView(new google.picker.DocsUploadView())
           .setDeveloperKey(developerKey)
           .setCallback(pickerCallback)
           .build();
       picker.setVisible(true);
     }
   }

   function saveBlocks() {
     BlocklyStorage.link();
     // Hack - fix later
     setTimeout(function() { saveDocument(); }, 350);
   }

// Retrieved from Internet and customised, give credit and reference
// http://dannyruijters.nl/webtex/googledrive.html

   function saveDocument() {

   			var content = window.location.href;
   			var method = 'POST';
   			var mimeType = 'text/plain';
   			var path = '/upload/drive/v2/files/';
   			var params = {'uploadType': 'multipart'};

   			if (metaData && 'id' in metaData)
   			{
   				//update existing file
   				method = 'PUT';
   				mimeType = metaData.mimeType;
   				path += metaData.id;
   				params = {'uploadType': 'multipart', 'fileId': metaData.id};
   			}
   			else
   			{
   				var fileName = prompt("Please enter the file name","filename.tex");
   				if (fileName == null) return;
   				metaData = {
                       'title': fileName,
                       'mimeType': mimeType,
                       'description': 'tex document'
                   };
   			}

   			var boundary = '-------314159265358979323846';
   			var delimiter = "\r\n--" + boundary + "\r\n";
   			var multipartRequestBody =
   				delimiter +
   				'Content-Type: application/json\r\n\r\n' +
   				JSON.stringify(metaData) +
   				delimiter +
   				'Content-Type: ' + mimeType + '\r\n' +
   				'Content-Length: ' + content.length + '\r\n' +
   				'\r\n' +
   				content +
   				'\r\n--' + boundary + '--';

   			gapi.client.request({
   				'path': path,
   				'method': method,
   				'params': params,
   				'headers': { 'Content-Type': 'multipart/mixed; boundary="' + boundary + '"' },
   				'body': multipartRequestBody}
   			).execute(function(newmeta) {
   				metaData = newmeta;});
          // Hack - fix later
          setTimeout(function() { location.reload(); }, 3000);
           }

   // A simple callback implementation.
   function pickerCallback(data) {
     if (data.action == google.picker.Action.PICKED) {
       var fileId = data.docs[0].id;

       alert('The user selected: ' + fileId);
     }
   }
   </script>
<script type="text/javascript" src="https://apis.google.com/js/client.js"></script>
</head>
<body>

  <table>
    <tr>
      <td>
      <span class="left">
      <h1>PythonBlocks</h1>
    </span>

      <span class="right">
      <button type="button" class="fancybuttons">Help</button>
      <button type="button" class="fancybuttons">Sample programs</button>
      <button type="button" class="fancybuttons" onclick="saveBlocks();">Save</button>
      <button type="button" class="fancybuttons" onclick="createPicker();">Load</button>
      <button type="button" class="fancybuttons" onclick="copyToClipboard()">Copy</button>
      <button type="button" class="fancybuttons" onclick="window.location.href='index.html'">Reset</button>
    </right>

      </td>
    </tr>

    <tr>
      <td id="blocklyArea">
      </td>

      <td style="vertical-align:top;text-align:center">
        <textarea id="output" class="codearea" rows="15" cols="75" readonly="true">PyBlocks Interpreter

      </textarea>
      <button type="button" class="fancybuttons" onclick="runfull()">Run full</button>
      <button type="button" class="fancybuttons" onclick="clr()">Clear console</button>
      <textarea id="codearea" cols="20" rows="7" hidden="true"></textarea>
      <textarea id="pycode" class="codearea" rows="12" cols="100" readonly="true" hidden="true"></textarea>
      </td>
    </tr>
  </table>

  <div id="blocklyDiv"></div>

  <xml id="toolbox">
  <!--  <category name="Test">
      <block type="python_for"></block>
      <block type="python_assign_float_list"></block>
      <block type="python_while"></block>
      <block type="python_int"></block>
      <block type="python_float_const"></block>
      <block type="python_string_const"></block>
      <block type="python_intvar2"></block>
      <block type="python_equals"></block>
      <block type="python_pow"></block>
      <block type="python_abs"></block>
      <block type="python_plus"></block>
      <block type="python_divide"></block>
      <block type="python_assign_intvar2"></block>
      <block type="python_assign_floatvar"></block>
      <block type="python_print"></block>
      <block type="python_list_index"></block>
      <block type="python_list_const"></block>
    </category> -->
    <category name="Numeric">
      <block type="python_int_const"></block>
      <block type="python_float_const"></block>
      <block type="python_plus"></block>
      <block type="python_minus"></block>
      <block type="python_multiply"></block>
      <block type="python_divide"></block>
      <block type="python_pow_op"></block>
      <block type="python_unary_minus"></block>
    </category>
    <category name="  Numeric Functions">
      <block type="python_round"></block>
      <block type="python_abs"></block>
      <block type="python_pow"></block>
      <block type="python_numeric_min"></block>
      <block type="python_numeric_max"></block>
      <block type="python_sum"></block>

    </category>
    <category name="Strings">
      <block type="python_string_const"></block>
      <block type="python_string_concat"></block>
      <block type="python_string_repeat"></block>
      <block type="python_string_index"></block>
      <block type="python_string_slice12"></block>
      <block type="python_string_slice1"></block>
      <block type="python_string_slice2"></block>
      <block type="python_string_len"></block>
      <block type="python_string_in"></block>
    </category>
    <category name="  String Methods">
      <block type="python_isdigit"></block>
      <block type="python_isalpha"></block>
      <block type="python_isspace"></block>
      <block type="python_lower"></block>
      <block type="python_upper"></block>
      <block type="python_find"></block>
      <block type="python_index_method"></block>
      <block type="python_string_count"></block>
      <block type="python_split"></block>
    </category>
    <category name="Conversions">
      <block type="python_int"></block>
      <block type="python_float"></block>
      <block type="python_str"></block>
      <block type="python_bool"></block>
      <block type="python_chr"></block>
      <block type="python_ord"></block>
      <block type="python_type"></block>
    </category>
    <category name="Comparisons">
      <block type="python_equals"></block>
      <block type="python_not_equals"></block>
      <block type="python_is"></block>
      <block type="python_less_than"></block>
      <block type="python_less_than_or_equal"></block>
      <block type="python_greater_than"></block>
      <block type="python_greater_than_or_equal"></block>
    </category>
    <category name="Booleans">
      <block type="python_true"></block>
      <block type="python_false"></block>
      <block type="python_and"></block>
      <block type="python_or"></block>
      <block type="python_not"></block>
    </category>
    <category name="Lists">
      <block type="python_list_empty"></block>
      <block type="python_list_const"></block>
      <block type="python_list_const2"></block>
      <block type="python_list_const3"></block>
      <block type="python_list_concat"></block>
      <block type="python_list_repeat"></block>
      <block type="python_list_index"></block>
      <block type="python_list_slice12"></block>
      <block type="python_list_slice1"></block>
      <block type="python_list_slice2"></block>
      <block type="python_list_len"></block>
      <block type="python_list_in"></block>
      <block type="python_list_min"></block>
      <block type="python_list_max"></block>
      <block type="python_sorted"></block>
    </category>
    <category name="  List Methods">
        <block type="python_append"></block>
        <block type="python_extend"></block>
        <block type="python_insert"></block>
        <block type="python_pop"></block>
        <block type="python_pop_statement"></block>
        <block type="python_remove"></block>
        <block type="python_reverse"></block>
        <block type="python_sort"></block>
        <block type="python_list_index_method"></block>
    </category>
    <category name="Input/Output">
      <block type="python_input"></block>
      <block type="python_print"></block>
      <block type="python_print2"></block>
    </category>
    <category name="Control">
      <block type="python_if"></block>
      <block type="python_while"></block>
      <block type="python_for"></block>
      <block type="python_range1"></block>
      <block type="python_range2"></block>
      <block type="python_range3"></block>
    </category>
    <category name="Variables">
      <block type="python_floatvar"></block>
      <block type="python_assign_floatvar"></block>
      <block type="python_floatvar2"></block>
      <block type="python_assign_floatvar2"></block>
      <block type="python_intvar2"></block>
      <block type="python_assign_intvar2"></block>
    </category>
    <category name=" List Variables">
      <block type="python_float_list"></block>
      <block type="python_assign_float_list"></block>
      <block type="python_assign_float_list_index"></block>
    </category>
  </xml>

<!-- Blockly storage code -->
<script>
  if ('BlocklyStorage' in window) {
    BlocklyStorage.HTTPREQUEST_ERROR = 'There was a problem with the request.\n';
    BlocklyStorage.LINK_ALERT = 'Share your blocks with this link:\n\n%1';
    BlocklyStorage.HASH_ERROR = 'Sorry, "%1" doesn\'t correspond with any saved Blockly file.';
    BlocklyStorage.XML_ERROR = 'Could not load your saved file.\n'+
        'Perhaps it was created with a different version of Blockly?';
  } else {
    document.write('<p id="sorry">Sorry, cloud storage is not available.  This demo must be hosted on App Engine.</p>');
  }

</script>

<!-- Blockly code -->

  <script>
  var blocklyArea = document.getElementById('blocklyArea');
  var blocklyDiv = document.getElementById('blocklyDiv');
  var workspace = Blockly.inject(blocklyDiv,
      {media: '../../media/',
       toolbox: document.getElementById('toolbox')});
  var onresize = function(e) {
    // Compute the absolute coordinates and dimensions of blocklyArea.
    var element = blocklyArea;
    var x = 0;
    var y = 0;
    do {
      x += element.offsetLeft;
      y += element.offsetTop;
      element = element.offsetParent;
    } while (element);
    // Position blocklyDiv over blocklyArea.
    blocklyDiv.style.left = x + 'px';
    blocklyDiv.style.top = y + 'px';
    blocklyDiv.style.width = blocklyArea.offsetWidth + 'px';
    blocklyDiv.style.height = blocklyArea.offsetHeight + 'px';
  };
  window.addEventListener('resize', onresize, false);
  onresize();

  function generateCode(event) {
    var content = document.getElementById('pycode');

      code = Blockly.Python.workspaceToCode(workspace);
      content.textContent = code;
  };

  workspace.addChangeListener(generateCode);

  if ('BlocklyStorage' in window && window.location.hash.length > 1) {
    BlocklyStorage.retrieveXml(window.location.hash.substring(1));
  }
  </script>

<!-- Google Drive code -->

<script type="text/javascript" src="https://apis.google.com/js/api.js?onload=loadPicker"></script>
</body>
</html>
